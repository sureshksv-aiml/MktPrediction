---
description: 
globs: *.py
alwaysApply: false
---
# Never Use `# type: ignore` Comments

## Context
Using `# type: ignore` comments to suppress type checker warnings is a code smell that masks underlying type safety issues. These comments:
- Hide real type problems that should be addressed
- Reduce code maintainability and type safety
- Can mask breaking changes during refactoring
- Make code harder to understand and debug
- Bypass the benefits of static type checking

Proper type handling through explicit type annotations, correct imports, and proper type definitions is always preferred over suppressing type checker warnings.

## Rule
1. **Never use** `# type: ignore` comments to suppress mypy, pyright, or other type checker warnings.
2. **Always fix** the underlying type issue instead of suppressing the warning.
3. **Use proper type annotations** and imports to resolve type checker errors.
4. **Import types correctly** using proper module paths and type stubs.

## Common Alternatives to `# type: ignore`

### Import Issues
| ❌ Bad (Suppressing) | ✅ Good (Proper Import) |
|---|---|
| `from google.cloud import storage  # type: ignore` | `from google.cloud.storage import Client as StorageClient` |
| `import some_module  # type: ignore` | `from typing import TYPE_CHECKING; if TYPE_CHECKING: import some_module` |

### Missing Type Annotations
| ❌ Bad (Suppressing) | ✅ Good (Proper Typing) |
|---|---|
| `def process(data):  # type: ignore` | `def process(data: Dict[str, Any]) -> None:` |
| `result = api_call()  # type: ignore` | `result: ApiResponse = api_call()` |

### Third-Party Library Issues
| ❌ Bad (Suppressing) | ✅ Good (Proper Handling) |
|---|---|
| `client.method()  # type: ignore` | `cast(MethodType, client.method)()` or proper type stubs |
| `from untyped_lib import func  # type: ignore` | Install type stubs: `pip install types-untyped-lib` |

### Complex Type Issues
| ❌ Bad (Suppressing) | ✅ Good (Proper Typing) |
|---|---|
| `return complex_obj  # type: ignore` | `return cast(ReturnType, complex_obj)` |
| `data[key] = value  # type: ignore` | Use `TypedDict` or proper generic types |

## Proper Solutions for Common Type Issues

### 1. Import Path Issues
```python
# Instead of: from google.cloud import storage  # type: ignore
# Use specific imports:
from google.cloud.storage import Client as StorageClient
from google.cloud.storage.bucket import Bucket
```

### 2. Missing Return Type Annotations
```python
# Instead of: def get_data():  # type: ignore
# Add proper return type:
def get_data() -> Dict[str, Any]:
    return {"key": "value"}
```

### 3. Any Types from External APIs
```python
# Instead of: result = api.call()  # type: ignore
# Use explicit casting or proper types:
result: ApiResponse = cast(ApiResponse, api.call())
```

### 4. Optional Type Checking Imports
```python
# For imports only needed for type checking:
from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from some_heavy_module import SomeType
```

## When Type Issues Seem Unavoidable

### Install Type Stubs
```bash
# For popular libraries, install official type stubs
pip install types-requests
pip install types-redis
pip install types-psycopg2
```

### Use Type Casting
```python
from typing import cast
# When you know the type but checker doesn't
result = cast(SpecificType, some_dynamic_value)
```

### Define Custom Types
```python
# Create proper type definitions for complex structures
from typing import TypedDict, Protocol

class ConfigDict(TypedDict):
    host: str
    port: int
    ssl: bool

class StorageProtocol(Protocol):
    def upload(self, file: bytes) -> str: ...
```

## Exceptions (Very Rare)
The only acceptable use of type suppression is in extremely rare cases where:
1. **Third-party library bug**: Library has incorrect type stubs that can't be fixed
2. **Temporary workaround**: During migration with documented plan to fix
3. **Platform-specific code**: Different types on different platforms

Even in these cases:
- Document WHY the suppression is needed
- Create a tracking issue to fix it properly
- Use the most specific suppression possible
- Set a deadline for proper fix

## Checklist for the Assistant
- [ ] Never suggest `# type: ignore` comments in any code.
- [ ] Always investigate and fix the root cause of type checker warnings.
- [ ] Use proper imports, type annotations, and type definitions.
- [ ] Install appropriate type stubs for third-party libraries.
- [ ] Use `typing.cast()` for legitimate type narrowing needs.
- [ ] Create custom types and protocols for complex structures.
- [ ] If unsure about proper typing, ask for clarification rather than suppress.

This ensures code maintains strong type safety and leverages the full benefits of static type checking.
